<div class="page-grid">
    <div class="posts-main">
        <?php if ($keyword): ?>
        <h2 style="margin-bottom:1rem">🔍 搜索:
            <?= htmlspecialchars($keyword) ?>
        </h2>
        <?php elseif ($catId): ?>
        <h2 style="margin-bottom:1rem">📁 分类文章</h2>
        <?php endif; ?>

        <?php if (empty($posts)): ?>
        <div class="post-card">
            <p>暂无文章</p>
        </div>
        <?php endif; ?>

        <div class="post-list">
            <?php foreach ($posts as $post): ?>
            <article class="post-card">
                <h2><a href="/post/index/view/<?= $post['id'] ?>">
                        <?= htmlspecialchars($post['title']) ?>
                    </a></h2>
                <div class="post-meta">
                    <span>📅
                        <?= date('Y-m-d', strtotime($post['created_at'])) ?>
                    </span>
                    <?php if (!empty($post['category_name'])): ?>
                    <a href="/?cat=<?= $post['category_id'] ?>" class="category">
                        <?= htmlspecialchars($post['category_name']) ?>
                    </a>
                    <?php endif; ?>
                </div>
                <p class="post-excerpt">
                    <?= htmlspecialchars($post['excerpt'] ?: mb_substr(strip_tags($post['body']), 0, 120)) ?>...
                </p>
                <a href="/post/index/view/<?= $post['id'] ?>" class="read-more">阅读全文 →</a>
            </article>
            <?php endforeach; ?>
        </div>

        <?php if ($totalPages > 1): ?>
        <nav class="pagination">
            <?php for ($i = 1; $i <= $totalPages; $i++): ?>
            <?php if ($i == $page): ?>
            <span class="current">
                <?= $i ?>
            </span>
            <?php else: ?>
            <a href="/home/index/index/<?= $i ?>">
                <?= $i ?>
            </a>
            <?php endif; ?>
            <?php endfor; ?>
        </nav>
        <?php endif; ?>
    </div>

    <aside class="sidebar">
        <div class="sidebar-widget">
            <h3>🔍 搜索</h3>
            <form method="GET" action="/" class="search-form">
                <input type="text" name="q" class="form-input" placeholder="搜索文章..."
                    value="<?= htmlspecialchars($keyword) ?>">
                <button type="submit" class="btn btn-primary btn-sm">搜索</button>
            </form>
        </div>
        <div class="sidebar-widget">
            <h3>📁 分类</h3>
            <ul>
                <li><a href="/" <?=!$catId ? 'style="color:var(--primary);font-weight:600"' : '' ?>>全部文章</a></li>
                <?php foreach ($categories as $cat): ?>
                <li><a href="/?cat=<?= $cat['id'] ?>" <?=$catId==$cat['id']
                        ? 'style="color:var(--primary);font-weight:600"' : '' ?>>
                        <?= htmlspecialchars($cat['name']) ?>
                    </a></li>
                <?php endforeach; ?>
            </ul>
        </div>
    </aside>
</div>